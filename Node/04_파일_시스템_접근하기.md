파일 시스템 접근하기
========

- 웹 브라우저에서 자바스크립트를 사용할 때는 파일 다운로드와 파일 시스템 접근이 금지되어 있음
- 노드에서는 fs 모듈을 이용하여 파일 시스템에 접근 및 제어 가능

## 1. 파일 읽기/쓰기

| 메소드 | 설명 |
|-|-|
| readFile(파일경로, 콜백함수) | 읽을 파일의 경로를 설정<br>콜백 함수는 에러, 데이터를 받음 |
| writeFile(파일경로, 내용, 콜백함수) | 쓸 파일의 경로와 내용을 설정<br>콜백 함수는 에러를 받음 |


## 2. 동기 메소드

- 노드는 대부분의 메소드를 비동기 방식으로 처리
- 몇몇 메소드는 동기 방식으로 사용 가능. 동기 메소드들은 이름 뒤에 Sync가 붙어있다
- 동기 메소드는 이전 작업이 완료되어야 다음 작업을 진행할 수 있으므로, 백그라운드가 작업하는 동안에는 메인 스레드는 대기해야 한다

### 순서

1. 비동기 메소드들은 메인 스레드가 백그라운드에 요청 처리를 위임
2. 읽기가 완료되면 백그라운드가 다시 메인 스레드에 알림
3. 백그라운드에서 요청 처리가 완료되면 등록된 콜백 함수 실행


## 3. 버퍼와 스트림


### 버퍼

- 파일을 읽을 때 메모리에 파일 크기만큼의 공간을 마련하고, 파일 데이터를 메모리에 저장하는데, 이때 메모리에 저장된 데이터가 버퍼
- Buffer 클래스를 이용하여 버퍼를 직접 조작 가능

| 메소드 | 설명 |
|-|-|
| from(문자열) | 문자열을 버퍼로 변경 |
| toString(버퍼) | 버퍼를 다시 문자열로 변경<br>base64, hex 인자 설정 시 해당 인코딩으로 변환 |
| concat(배열) | 배열 안에 든 버퍼들을 하나로 합침 |
| alloc(바이트) | 빈 버퍼 생성. 바이트를 인자로 설정 시 해당 크기의 버퍼가 생성됨 |


### 스트림

- 파일 크기만큼 메모리 공간을 할당하면 메모리 용량 문제가 발생
- 버퍼 크기를 줄여서 여러 번에 나누어서 전송하는 방식이 등장
- 이 방식을 편하게 만든 것이 스트림
- 나누어진 조각을 chunk라고 함
- 이벤트 리스너를 붙여서 사용
  - 주로 data, end, error, finish 이벤트를 사용함

#### 스트림 생성 메소드

| 메소드 | 설명 |
|-|-|
| createReadStream(파일경로, 옵션) | 읽기 스트림 생성<br>옵션 객체 중 highWaterMark 속성으로 버퍼 크기 지정 가능. 기본값은 64KB |
| createWriteStream(파일경로, 옵션) | 쓰기 스트림 생성 |


## 4. 파이프 메소드

- `pipe()`
- 스트림끼리의 연결
- 미리 읽기/쓰기 스트림을 만든 뒤, 두 개의 스트림을 pipe 메소드로 연결하면 이벤트 등록 등의 설정 없이 데이터가 복사됨


## 5. 기타 fs 메소드

| 메소드 | 설명 |
|-|-|
| fs.access(경로, 옵션, 콜백) | 폴더나 파일에 접근할 수 있는지 체크<br>두번째 파라미터로는 상수<br>옵션: F_OK = 파일 존재 여부, R_OK=읽기 권한 여부, W_OK=쓰기 권한 여부<br>권한 없을 시 에러 발생 |
| fs.mkdir(경로, 콜백) | 폴더 생성 메소드. 이미 폴더가 있다면 에러가 발생하므로 먼저 access() 메소드로 체크 |
| fs.open(경로, 옵션, 콜백) | 파일의 아이디(fd 변수)를 가져오는 메소드. 파일이 없다면 파일을 생성한 뒤 그 아이디를 가져옴<br>아이디를 사용해 read, write 메소드 사용 가능<br>옵션: 쓰기='w', 읽기='r', 기존 파일에 추가='a' |
| fs.rename(기존경로, 새경로, 콜백) | 파일의 이름을 바꾸는 메소드. 같은 폴더를 지정할 필요는 없기에 잘라내기 같은 기능으로도 사용 가능 |
| fs.readdir(경로, 콜백) | 폴더 안의 내용물 확인. 배열 안에 내부 파일과 폴더명이 나옴 |
| fs.unlink(경로, 콜백) | 파일을 지움. 파일이 없다면 에러 발생 |
| fs.rmdir(경로, 콜백) | 폴더를 지움. 폴더 내부에 파일이 있다면 에러 발생 |
| fs.copyFile(복사대상, 저장경로, 콜백) | 파일을 복사 |

--------

> [fs 프로미스](http://nodejs.org/dist/latest-v10.x/docs/api/fs.html#fs_fs_promises_api)
서브 쿼리
========


## 1. 서브쿼리 개요

- 하나의 SQL문 안에 포함되어 있는 또 다른 SQL문
- 서브쿼리는 메인쿼리 안에 포함된 종속적인 관계이기 때문에 논리적인 실행순서는 항상 메인쿼리에서 읽혀진 데이터에 대해 서브쿼리에서 해당 조건이 만족하는지를 확인하는 방식으로 수행되어야 한다

### 가. 사용 시 주의사항

1. 서브쿼리를 괄호로 감싸서 사용
2. 서브쿼리는 단일 행 또는 복수 행 비교 연산자와 함께 사용 가능. 단일 행 비교 연산자는 서브쿼리의 결과가 반드시 1건 이하여야 하고, 복수 행 비교 연산자는 서브쿼리의 결과 건수와 상관 없다
3. 서브쿼리에서는 ORDER BY를 사용하지 못 한다. ORDER BY절은 SELECT 절에서 오직 한 개만 올 수 있기 때문에 메인 쿼리의 마지막 문장에 위치해야 한다

### 나. 서브쿼리가 사용 가능한 곳

- SELECT 절
- FROM 절
- WHERE 절
- HAVING 절
- ORDER BY 절
- INSERT문의 VALUES 절
- UPDATE문의 SET 절

### 다. 동작 방식에 따른 서브쿼리 분류

| 서브쿼리 종류 | 설명 |
|-|-|
| 비연관 서브쿼리 | 서브쿼리가 메인쿼리 컬럼을 가지고 있지 않는 형태의 서브쿼리. 메인쿼리에 값을 제공하기 워한 목적으로 주로 사용 |
| 연관 서브쿼리 | 서브쿼리가 메인쿼리 컬럼을 가지고 있는 형태의 서브쿼리. 메인쿼리가 먼저 수행되어 읽혀진 데이터를 서브쿼리에서 조건이 맞는지 확인하고자 할 때 주로 사용 |


## 2. 다중 행 서브쿼리

서브쿼리의 결과가 2건 이상 반환될 수 있다면 반드시 다중 행 비교 연산자와 함께 사용해야 한다

| 다중 행 연산자 | 설명 |
|-|-|
| IN (서브쿼리) | 서브쿼리의 결과에 존재하는 임의의 값과 동일한 조건을 의미 |
| 비교연산자 ALL (서브쿼리) | 서브쿼리의 결과에 존재하는 모든 값을 만족하는 조건을 의미 |
| 비교연산자 ANY (서브쿼리) | 서브쿼리의 결과에 존재하는 어느 하나의 값이라도 만족하는 조건을 의미 |
| EXISTS (서브쿼리) | 서브쿼리의 결과를 만족하는 값이 존재하는지 여부를 확인하는 조건을 의미. 만족하는 건이 여러 건이더라도 1건만 찾으면 더 이상 검색하지 않음 |


## 3. 스칼라 서브쿼리

- 한 행, 한 컬럼만을 반환하는 서브쿼리를 말함
- 스칼라 서브쿼리는 컬럼을 쓸 수 있는 대부분의 곳에서 사용 가능하다. 주로 SELECT 절에서 사용

## 4. 인라인 뷰
- FROM 절에서 사용되는 서브쿼리
- 서브쿼리의 결과를 동적으로 생성된 테이블인 것 처럼 사용
- 인라인 뷰는 SQL문이 실행될 때만 임시적으로 생성되는 동적인 뷰이기 때문에 DB에 해당 정보가 저장되지 않는다


## 5. 뷰(View)

`CREATE VIEW 뷰이름 AS SELECT 컬럼명1, 컬럼명2, ... FROM 테이블명 [WHERE 조건식]`

- 뷰는 실제 데이터를 가지고 있지 않으며, 단지 뷰 정의만을 가지고 있다
- 뷰는 실제 데이터를 가지고 있지 않지만, 테이블이 수행하는 역할을 수행하기 때문에 가상 테이블이라고도 한다

### 뷰 사용시의 장점

| 뷰의 장점 | 설명 |
|-|-|
| 독립성 | 테이블 구조가 변경되어도 뷰를 사용하는 응용 프로그램은 변경하지 않아도 된다 |
| 편리성 | 복잡한 질의를 뷰로 생성함으로써 관련 질의를 단순하게 작성할 수 있다. 또한 해당 형태의 SQL문을 자주 사용할 때 뷰를 이요하면 편리하게 사용할 수 있다 |
| 보안성 | 숨기고 싶은 정보가 존재한다면, 뷰를 생성할 때 해당 컬럼을 제외하고 생성함으로서 사용자에게 정보를 감출 수 있다 |



테스트
========

## 단위 테스트(Unit Test)

- 작은 단위의 코드에 대해 테스트를 수행하는 것
- 단위 테스트를 하는 이유는 개발자가 설계하고 만든 코드가 원래 의도한 대로 동작하는지를 개발자 스스로 빨리 확인받기 위함
- 테스트하고자 하는 대상이 명확하다면 그 대상에만 집중해서 테스트하는 것이 바람직
- 통제할 수 없는 외부의 리소스에 의존하는 테스트는 단위 테스트가 아니다
- 항상 일관성 있는 결과가 보장되어야 함
  - 테스트를 실행하는 순서를 바꿔도 동일한 결과가 보장되도록 만들어야 함


## JUnit 테스트

- 테스트가 main() 메소드로 만들어졌다는건 제어권을 직접 가진다는 의미
  - 테스팅 프레임워크로 전환이 바람직
  - 프레임워크: 개발자가 만든 클래스에 대한 제어 권한을 넘겨받아 주도적으로 애플리케이션의 흐름을 제어
- 테스트는 자동화되어야 하고, 빠르게 실행될 수 있어야 함
- JUnit은 자바의 표준 테스팅 프레임워크라 불러도 무방


## JUnit 테스트 실행 방법

- IDE가 지원하는 JUnit Test 기능을 활용
- Maven이나 Gradle 같은 빌드 툴에서 제공하는 JUnit 플러그인이나 태스크를 이용


## 기능 설계를 위한 테스트

- 조건: 어떤 조건을 가지고
- 행위: 무엇을 할 때
- 결과: 어떤 결과가 나온다
- 기능 설계, 구현, 테스트라는 일반적인 개발 흐름의 기능 설계에 해당하는 부분을 테스트 코드가 일부분 담당하고 있다 볼 수 있다


## 테스트 주도 개발(TDD)

- 테스트를 먼저 만들고 그 테스트가 성공하도록 하는 코드만 만드는 식으로 진행
- 테스트를 작성하고 이를 성공시키는 코드를 만드는 작업의 주기를 가능한 한 짧게 가져가도록 권장


## JUnit이 하나의 테스트 클래스를 가져와 수행하는 방식

1. 테스트 클래스에서 `@Test`가 붙은 public 이고 void 형이며 파라미터가 없는 테스트 메소드를 모두 찾음
2. 테스트 클래스의 오브젝트를 하나 만듬
3. `@Before`가 붙은 메소드가 있으면 실행
4. `@Test`가 붙은 메소드를 하나 호출하고 테스트 결과를 저장
5. `@After`가 붙은 메소드가 있으면 실행
6. 나머지 테스트 메소드애 대해 2~5번을 반복
7. 모든 테스트의 결과를 종합해서 돌려줌


## 유의점

- 각 테스트 메소드를 실행할 때마다 테스트 클래스의 오브젝트를 새로 만든다
- 한번 만들어진 테스트 클래스의 오브젝트는 하나의 테스트 메소드를 사용하고 나면 버려진다

> 각 테스트가 서로 영향을 주지 않고 독립적으로 실행됨을 확실히 보장해주기 위함


## 스프링 테스트

- 스프링은 JUnit을 이용하는 테스트 컨텍스트 프레임워크를 제공
- 테스트 컨텍스트의 지원을 받으면 간단한 애노테이션 설정만으로 테스트에서 필요로 하는 애플리케이션 컨텍스트를 만들어서 모든 테스트가 공유하게 할 수 있음
- 여러 테스트 클래스가 모두 같은 설정 파일을 가진 애플리케이션 컨텍스트를 사용한다면, 스프링은 테스트 클래스 사이에서도 애플리케이션 컨텍스트를 공유하게 해준다
- 테스트는 필요하다면 얼마든지 애플리케이션 클래스와 밀접한 관계를 맺고 있어도 상관없다
  - 개발자가 만드는 테스트는 코드 내부구조와 설정 등을 알고 있고 의도적으로 그 내용을 검증해야 할 필요가 있기 때문


## DI를 적용해야 하는 이유

1. 소프트웨어 개발에서 절대로 바뀌지 않는 것은 없음
2. 클래스의 구현 방식은 바뀌지 않는다고 하더라도 인터페이스를 두고 DI를 적용하게 해두면 다른 차원의 서비스 기능을 도입할 수 있음
3. DI는 테스트가 작은 단위의 대상에 대해 독립적으로 만들어지고 실행되게 하는 데 중요한 역할을 한다


## DI를 이용한 테스트 방법 선택

- 항상 스프링 컨테이너 없이 테스트할 수 있는 방법을 가장 우선적으로 고려
  - 테스트 수행 속도가 가장 빠르고, 테스트 자체가 간결함
  - 테스트를 위해 필요한 오브젝트의 생성과 초기화가 단순하다면 이 방법을 가장 먼저 고려
- 여러 오브젝트와 복잡한 의존관계를 갖고 있는 오브젝트를 테스트하는 경우, 스프링의 설정을 이용한 DI 방식의 테스트를 이용
  - 테스트에서 애플리케이션 컨텍스트를 사용하는 경우에는 테스트 전용 설정파일을 따로 만들어 사용하는 편이 좋음
- 테스트 설정을 따로 만들었다고 하더라도 때로는 예외적인 의존관계를 강제로 구성해서 테스트해야 하는 경우, 컨텍스트에서 DI 받은 오브젝트에 다시 테스트 코드로 수동 DI해서 테스트하는 방법을 사용
  - `@DirtiesContext` 애노테이션 사용


## 버그 테스트

- 코드에 오류가 있을 때 그 오류를 가장 잘 드러내줄 수 있는 테스트
- 일단 실패하도록 만든 뒤, 그 버그 테스트가 성공할 수 있도록 애플리케이션 코드를 수정
- 테스트가 성공하면 버그는 해결된 것


## 버그 테스트의 장점

- 테스트의 완성도를 높여줌
- 버그의 내용을 명확하게 분석하게 해줌
- 기술적인 문제를 해결하는 데 도움이 됨


## 동등 분할과 경계값 분석

### 동등 분할(Equivalencne partitioning)

- 같은 결과를 내는 값의 범위를 구분해서 각 대표 값으로 테스트하는 방법
- 어떤 작업의 결과의 종류가 true, false 또는 예외 발생 세 가지라면 각 결과를 내는 입력 값이나 상황 조합을 만들어 모든 경우에 대한 테스트를 해보는 것이 좋음


### 경계값 분석(Boundary value analysis)

- 에러는 동등분할 범위의 경계에서 주로 많이 발생한다는 특징을 이용해서 경계의 근처에 있는 값을 이용해 테스트하는 방법
- 보통 숫자의 입력 값인 경우 0이나 그 주변 값 또는 정수의 최대값, 최소값 등으로 테스트


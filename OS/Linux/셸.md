셸(Shell)
========


## 셸 개요

- 커널과 사용자 간의 가교 역할을 하는 명령어 해석기 또는 명령 행 인터페이스
- 셸의 의미는 커널을 감싼 껍질
- 셸은 명령어 해석기이면서 스크립트 언어이기도 함
- 셸 스크립트 파일에 셸 명령어로 구성된 프로그램을 작성하면 셸이 스크립트 파일을 읽어 일련의 명령을 수행시킬 수 있음

## 셸 종류

| 셸 이름 | 셸 실행 명령 |
|-|-|
| Bourne Shell | sh |
| C Shell | csh |
| TC Shell | tcsh |
| Korn Shell | ksh |
| Bourne Again Shell (Bash) | bash |

- bash 셸이 많은 리눅스 배포판에서 기본 셸로 사용됨
  - Bourne 셸과 호환되며 속도와 편의성을 개선한 GNU의 무료 공개용 버전
- 명령을 입력할 수 있는 라인을 명령 행 이라 하며, 명령의 대기 중임을 알리는 프롬프트가 표시됨
  - 기본 프롬프트는 `$`
  - 루트 사용자는 `#`
- 셸은 운영체제의 일부이면서 커널에서 분리된 프로그램이므로 셸의 종류에 따라 alias 설정, 초기화 파일, 스크립트 작성 등에서 다른 특성을 가질 수 있음


## 셸 선택

`chsh [options] [username]`

- 기본 셸을 변경할 때 사용하는 명령어
- 사용자가 생략되면 사용자 본인을 대상으로 함
- 다른 사용자의 셸을 바꾸려면 권한이 필요

### 옵션

- `-l`: /etc/shells에 기록된 가용한 셸을 나열
- `-s shell`: 로그인 셸을 변경
- `-u`: 도움말을 출력


## 명령의 옵션과 인수

### 유닉스 스타일 옵션

- 짧은 옵션
- 1개의 문자를 대시(`-`) 문자 뒤에 붙여 사용
- 여러 옵션을 사용할 때는 여러 옵션을 개별적으로 나열할 수도 있고, 대시(`-`) 뒤에 모두 붙여 사용할 수도 있음
- 옵션에 인수가 필요한 경우 공백 다음에 인수를 위치시킴

### GNU 스타일 옵션

- 긴 옵션
- 이중 대시(`--`) 뒤에 단어를 붙여 사용
- 옵션에 인수가 필요한 경우 공백 없이 바로 등호(`=`)와 인수를 붙임


## 환경 변수

- 사용자가 수행하는 명령은 셸의 환경 변수 중 PATH 변수에 설정되어 있는 경로 중에서 상응하는 실행 프로그램을 찾을 수 있어야 함
- 셸이 명령 수행을 위해 실행 프로그램을 찾을 때 현재 작업 디렉터리를 자동으로 검색하지는 않음


## 명령의 종류

- 셸의 모든 명령이 환경 변수 PATH에 포함되어 있는 디렉터리에 실행 파일로 존재하는 것은 아님
- 셸 자체에 포함된 내장 명령도 있음


### 단축 명령 만들기: alias

- 자주 사용되는 명령의 별칭을 만드는 명령어
- alias라는 이름만으로 실행 시 현재 정의되어 있는 에일리어스 목록을 보여줌
- `unalias 별칭` 명령으로 해제 
- 로그인 시에도 계속 에일리어스 설정을 유지하려면 셸의 환경 설정 파일에 기록해야 함


### 명령의 해석 방법 알기: type

- 특정 명령을 어떻게 해석하는지 알기 위해 사용
- 일반 명령의 경우 실행 파일의 위치를 보여줌
- 여러 유형으로 명령이 존재하는 경우 `-a` 옵션을 사용하면 모든 사항을 확인 가능


### 실행 프로그램 찾기: which

- 셸 명령을 지정하고 이것의 실제 실행 프로그램을 알아내기 위한 명령
- 명령이 실행되는 경우 사용자의 PATH 환경 변수를 기초로 상응하는 실행 프로그램이 어느 디렉터리에 존재하는지 찾아서 절대경로 방식으로 출력하는 명령


### 실행 프로그램 확인: whereis

- 찾고자 하는 명령을 whereis 명령의 인수로 지정하여 실행하면 명령의 실행 프로그램이 어디에 있는지 찾아서 알려준다
- which 명령과 유사하나 소스와 매뉴얼 페이지가 존재하는 경우 해당 파일도 찾아서 출력해줌


### 온라인 매뉴얼 페이지 보기: man

- 명령 행에서 실행될 수 있는 대부분의 프로그램에 대해 리눅스는 매뉴얼 페이지를 제공
- man 명령어를 사용하면 매뉴얼 페이지를 볼 수 있으며 각종 프로그램의 사용법을 자세히 확인 가능
- 특정 섹션에 존재하는 매뉴얼 페이지를 보려면 섹션 번호를 인수로 제공해야 함


## 명령 히스토리

- 이전에 수행했던 명령의 목록을 의미
- 셸에서 history 명령을 실행하면 이전에 입력했던 명령 행의 목록을 불러와 볼 수 있음


### 명령 행 불러오기

- 이전에 입력했던 특정 명령 행을 불러와 편집한 후 다시 수행할 수 있다
- history 명령에서 출력된 목록 중 하나를 불러와 다시 실행하려는 경우
  - `!!`: 직전에 수행했던 명령
  - `!n`: 히스토리 목록에서 번호 n에 해당하는 명령
  - `!-n`: n번째로 앞에 수행한 명령. `!-1`은 직전 명령을 의미
  - `!string`: 지정 문자열로 시작하는 가장 최근의 명령
  - `!?string`: 지정된 문자열을 포함하는 명령 중 가장 최근의 명령
- 상하 화살표를 이용하여 해당 명령을 불러와 편집할 수도 있음


### 명령 히스토리와 환경 변수

- 셸을 끝내면 수행된 명령어 목록이 홈 디렉터리에 있는 `.bash_history` 파일에 기록됨
- 기본적으로 1000개의 명령 행이 기록됨
- 차후 다시 셸을 시작하면 이 파일로부터 히스토리 목록을 가져와 초기화 함

### 명령 행 완성 기능

- 셸 명령을 입력할 때 일부만 타이핑하고 나머지 부분을 자동으로 완성하는 기능
- 자동 완성을 위해 처음 몇 자만을 타이핑한 후 탭키를 누르면 셸이 부분적으로 타이핑한 내용을 다음 중 하나로 판단하여 확장함
  - 명령어, 에일리어스, 함수: 보통 문자로 시작하는 경우 명령어, 에일리어스, 함수의 이름으로 판단
  - 변수: 달러(`$`) 기호로 시작하는 경우 현재 셸에서 사용되는 변수로 판단
  - 디렉터리: 틸드(`~`) 문자로 시작하는 경우 디렉터리를 표시. ~는 현재 작업 중인 사용자의 홈 디렉터리를 표시. - 기호는 이전 작업 디렉터리를 표시
  - 호스트 이름: at(`@`) 기호로 시작하는 경우 /etc/hosts 파일에 기록된 호스트 이름으로 판단
- 대상을 하나로 결정짓지 못하는 경우 탭을 두 번 연속으로 누르면 가능한 모든 확장의 경우를 즉시 출력하여 보여줌
- 파일의 경우 esc 키를 두 번 두르면 입력하지 않은 파일 이름의 나머지 부분을 자동으로 완성시켜줌


## 명령의 연결과 확장

- 명령어와 명령어 사이 또는 명령어와 파일 사이에 출력과 입력을 연결하여 조합할 수 있다
- 파이프와 입출력 리다이렉션을 위해 특수문자 `|`, `<`, `>`, `<<`, `>>` 가 사용됨

### 셸에서 사용되는 특수 문자

| 문자 | 의미 |
|-|-|
| 화이트스페이스 | 엔터는 명령 행을 종료하고 명령을 실행. 스페이스바와 탭은 명령 행을 구성하는 요소를 분리하기 위한 것 |
| '' </br> "" | 공백을 포함하는 문자열을 표시할 때나 특별한 의미를 가진 문자를 일반 문자로 처리하기 위해 사용  |
| `` | 명령 치환 기능을 수행 |
| \ | 이스케이프 문자라고도 부름. 특수 문자 앞에 붙어 특수 문자의 기능을 제거. **긴 명령 행을 연장할 때도 사용** |
| ~ | ~ 또는 ~username은 사용자의 홈 디렉터리를 의미 |
| . | 현재 작업 디렉터리를 표시. 명령 행의 맨 앞에서 사용되면 셸 스크립트를 실행하는 source 명령과 동일 |
| .. | 현재 디렉터리의 부모 디렉터리를 표시 |
| # | # 문자의 뒤에 나타나는 문자를 주석으로 처리 |
| $ | `$변수`는 변수의 값을 추출 |
| & | `명령&`는 명령을 백그라운드로 실행함 |
| * | 파일 이름에서 사용할 때 0개 이상의 임의 문자열과 대응됨 |
| ? | 파일 이름에서 사용할 때 1개 문자와 대응됨 |
| ; | 여러 명령을 순서대로 실행할 때 구분을 위해 사용 |
| \| | **앞 명령의 출력을 다음 명령의 입력으로 연결시킴** |
| < 또는 > | 파일로부터 입력받을 때 또는 파일로 출력할 때 사용 |
| >> | 표준 출력을 파일의 끝에 덧붙일 때 사용 |
| ! | 명령 히스토리 기능을 이용할 때 사용 |
| [] | 파일 이름을 지정할 때 대응되는 문자의 범위를 지정. 내부의 문자 중 하나와 대응됨 |  
| {} | 파일 이름을 지정할 때 대응되는 문자의 범위를 지정. 내부의 콤마로 구분되는 것 중 하나와 대응됨 |


### 파이프와 입출력 리다이렉션

| 작업 | 설명 |
|-|-|
| command > file | 표준출력을 지정된 파일로 보낸다 |
| command 2 > file | 표준오류 출력을 지정된 파일로 보낸다 |
| command > file 2 > &1 | 표준출력과 표준오류 출력을 지정된 파일로 보낸다 |
| command < file | 지정된 파일을 표준입력으로 지정하여 읽는다 |
| command < file.in > file.out | file.in을 표준입력으로 지정하여 읽고 표준출력을 file.out으로 보낸다 |
| command >> file | 표준출력을 지정된 파일의 끝에 덧붙인다 |
| command 2 >> file | 표준오류 출력을 지정된 파일의 끝에 덧붙인다 |
| command >> file 2 > &1 | 표준출력과 표준오류 출력을 지정된 파일의 끝에 덧붙인다 |
| command << c | 지정된 문자가 나올 때까지 키보드로부터 표준입력을 읽는다 |
| command1 \| command2 | 앞 명령의 결과에서 표준출력을 뒤 명령으로 연결한다 |
| command1 2 > &1 \| command2 | 앞 명령의 결과에서 표준출력과 표준오류 출력을 뒤 명령으로 연결한다 |

- 파이프(`|`) 문자를 사용하면 한 명령의 출력을 다음 명령의 입력으로 연결시킬 수 있음
- 명령을 수행할 때 필요한 입력을 표준입력(키보드)으로부터 읽어들이지 않고 파일로부터 입력을 받는 경우 `<`를 사용
  - 표준입력을 지정된 파일로 리다이렉션 하는 기능을 제공
- 명령의 결과를 출력하지 않고 파일에 기록하는 경우 `>`를 사용
  - 표준출력(화면)을 지정된 파일로 리다이렉션 하는 기능을 제공

### 명령 치환

- `$(command)` 또는 `｀command｀` 형태
- 한 명령의 결과를 다른 명령의 인수로 사용하는 방법
- 지정된 부분의 명령을 셸이 먼저 해석한 후 처리하는 것
- `$()` 를 사용하는 것이 가독성에 좋음


### 인용 부호

- 빈칸을 포함하는 문자열을 1개의 인수로 사용할 때 인용부호(또는 따옴표)를 사용
- 작은따옴표를 사용하면 따옴표 안에 있는 모든 특수 문자의 의미를 제거
- 큰따옴표는 작은따옴표와 유사하나 예외적으로 달러($), 역따옴표(｀｀), 백슬래시(\) 문자를 해석하여 확장
  - 히스토리에서 사용하는 느낌표(!)도 해석
  - 백슬래시는 그 뒤에 $, ｀, ". ' 또는 \가 나올 때만 특별한 의미를 유지


### 수식과 변수의 확장

- 수식의 결과를 명령에 전달하는 방법을 수식의 확장이라 함
- `$[expression]` 또는 `$((expression))`의 형태를 가짐


## 셸 변수

- 셸 스크립트에서 특별한 값을 유지하기 위해 셸 변수를 사용할 수 있음
- 현재 사용 중인 셸에서 설정되어 있는 모든 변수를 확인하려면 단순히 set 명령을 사용


### 환경 변수

- 보통의 셸 변수와 다르게 현재 셸로부터 새로운 서브 셸이 만들어질 때 전달되는 변수를 의미
- 환경 변수가 아닌 셸 변수는 현재 셸에서만 유효한 지역 변수
- 환경 변수는 현재 셸과 그것의 서브 셸에서 공통적으로 사용할 수 있는 전역 변수라 할 수 있음
- 보통 환경 변수의 이름은 대문자를 사용
- env 또는 printenv 명령을 사용하면 모든 환경 변수와 그것의 값을 출력함
- 셸 변수를 설정하고 값을 지정하려면 등호를 사용
- 변수를 환경 변수로 만드려면 `export variable` 명령을 사용
- 환경 변수의 값을 확인하려면 `printenv variable` 또는 `echo $variable`을 수행
- 설정되어 있는 변수를 삭제하려면 `unset variable` 명령을 사용


### 자주 사용되는 일반적 환경 변수

| 변수 | 내용 |
|-|-|
| BASH | bash 명령의 완전한 경로로 대개 /bin/bash |
| HISTCMD | 히스토리 목록에서 가장 최근의 명령을 표시하는 번호 |
| HOME | 홈 디렉터리 |
| MAIL | 메일박스에 해당하는 파일. 보통 /var/spool/mail/username |
| OLDPWD | cd 명령을 사용하기 직전의 작업 디렉터리 |
| PATH | 명령을 수행할 때 실행 파일을 찾기 위한 디렉터리 목록. 디렉터리는 콜론(:)으로 구분되어 설정됨 |
| PS1 | 셸 프롬프트를 표시하기 위한 문자열. 명령어 수행 시 추가로 프롬프트가 필요한 경우 변수 PS2, PS3 등을 설정하여 사용 |
| PWD | 현재 작업 디렉터리 |
| PPID | 셸의 부모 프로세스 ID |
| SHELL | 사용 중인 기본 셸 |
| USER | 사용자 계정을 의미하는 이름 |
| UID | 현재 사용자의 ID |
| IFS | 내부 필드 구분자라고 하며 공백 문자, 탭 문자, 개행 문자를 기본 값을 지님. 셸 내장 명령인 read 명령으로 읽은 행을 단어로 분리할 때나 확장 후에 단어를 분리할 때 기준으로 사용하는 문자를 의미 |


### 로그인과 환경 설정 파일

- 로그인할 때 수행되는 셸을 로그인 셸이라고 한다
- 로그인 셸에서만 logout 명령을 사용하여 로그아웃을 할 수 있다
- 셸에서 su -l username을 수행하면 지정된 사용자 계정으로 로그인할 수 있음
- 로그인 시도 시, 로그인 후 셸 시작 시 환경 설정을 위해 자동으로 수행되는 설정 파일이 존재
  - 개별 사용자를 위한 초기화 스크립트로서 개별 사용자가 자신의 의도대로 환경을 설정할 때 사용
  - `/etc/profile`: 모든 사용자에게 적용되는 시스템 수준의 환경 설정 파일. 로그인할 때 가장 먼저 수행됨. 루트 사용자만 수정 가능
  - `~/.bash_profile`: 로그인할 때 수행되며 개별 사용자에게 적용되는 환경 설정 파일. 보통 내부에서 `~/.bashrc`를 실행. 이 파일에서 설정된 변수는 모든 셸에 전달되어 로그아웃할 때까지 유효
  - `~/.bashrc`: 로그인 후에 셸을 시작할 때 수행. 개별 사용자에게 적용되는 설정 파일. 내부에서 `/etc/bashrc`를 수행
  - `/etc/bashrc`: 로그인 후에 셸을 시작할 때 가장 먼저 수행되며, 모든 사용자에ㅐ게 적용되는 설정 파일.루트 사용자만 수정 가능
  - `~/.bash_logout`: 로그아웃을 수행할 때 실행되는 스크립트 파일

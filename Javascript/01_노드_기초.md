노드 기초
========

## 1. 자바스크립트 런타임

- Node.js는 크롬 V8 자바스크립트 엔진으로 빌드된 자바스크립트 런타임
  - **런타임** : 특정 언어로 만든 프로그램들을 실행할 수 있는 환경
  - 즉, 노드는 자바스크립트 프로그램을 컴퓨터에서 실행할 수 있는 환경을 제공
- 노드는 V8과 libuv라는 라이브러리를 사용
  - V8과 libuv는 C와 C++로 구현되어 있음
  - libuv 라이브러리는 노드의 특성인 이벤트 기반, 논블로킹 I/O 모델을 구현하고 있음


## 2. 이벤트 기반

- 이벤트가 발생할 때 미리 지정해둔 작업을 수행하는 방식을 의미
  - 특정 이벤트가 발생할 때 무엇을 할지 미리 등록해야 함 -> **이벤트 리스너에 콜백 함수를 등록**한다고 표현
  - 여러 이벤트가 동시에 발생했을 때 어떤 순서로 콜백 함수를 호출할지를 이벤트 루프가 판단
- **이벤트 루프** : 이벤트 발생 시 호출할 콜백 함수를 관리하고, 호출된 콜백 함수의 실행 순서를 결정하는 역할을 담당. 노드가 종료될 때까지 이벤트 처리를 위한 작업을 반복하므로 루프라고 불림
- **태스크 큐** : 이벤트 발생 후 호출되어야 할 콜백 함수들이 기다리는 공간. 콜백들이 이벤트 루프가 정한 순서대로 줄을 서 있으므로 콜백 큐라고도 불림
- **백그라운드** : 타이머나 I/O 작업 콜백 또는 이벤트 리스너들이 대기하는 곳

### 코드 실행 과정

1. 함수들이 호출 스택에 쌓임
2. 실행된 함수의 콜백 함수가 백그라운드에 보내짐
3. 백그라운드에서 함수를 태스크 큐로 보냄
4. 호출 스택 실행이 모두 끝내 비게 된 경우
5. 이벤트 루프가 태스크 큐의 콜백을 호출 스택으로 올림
6. 콜백 함수가 호출 스택에서 실행되고 비워짐
7. 이벤트 루프는 태스크 큐에 콜백이 들어올 때까지 대기


## 3. 논블로킹 I/O

- **논블로킹**: 이전 작업이 완료될 때까지 멈추지 않고 다음 작업을 수행
  - 이벤트 루프를 활용
  - 오래 걸리는 함수를 백그라운드로 보내서 다음 코드가 먼저 실행되게 하고
  - 그 함수가 다시 태스크 큐를 거쳐 호출 스택으로 올라오기를 기다리는 방식
- **I/O**: 입력(Input) / 출력(Output)
  - 파일 시스템 접근(파일 읽기, 쓰기, 폴더 만들기 등)
  - 네트워크 요청
  - 해당 작업을 할 때 노드는 논블로킹 방식으로 동작

### setTimeout(cb, 0)

- 코드를 논블로킹으로 만드릭 위해 사용하는 기법 중 하나
- setTimeout의 콜백 함수가 태스크 큐로 보내지므로 순서대로 실행되지 않음
- 브라우저와 노드에서는 기본적인 지연 시간이 있으므로 약간의 지연이 있음
  - HTML5 브라우저에서는 4ms
  - 노드에서는 1ms

## 4. 싱글 스레드

- **프로세스** : 운영체제에서 할당하는 작업의 단위. 프로세스 간에는 메모리 등의 자원을 공유하지 않음
- **스레드** : 프로세스 내에서 실행되는 흐름의 단위. 스레드들은 부모 프로세스의 자원을 공유
- 노드는 스레드를 늘리는 대신, 프로세스 자체를 복사해 여러 작업을 동시에 처리하는 멀티 프로세싱 방식을 사용함


## 5. 서버로서의 노드

- 노드 서버는 I/O가 많은 작업에 적합
  - I/O 작업을 논블로킹 방식으로 처리하기 때문에 스레드 하나가 많은 수의 I/O를 감당할 수 있음
  - 개수는 많지만 크기는 작은 데이터를 실시간으로 주고 받는데 적합
  - 실시간 채팅 앱, 주식 차트, API 서버 등...
- CPU 부하가 큰 작업에는 적합하지 않음
  - 이미지, 비디오 처리, 대규모 데이터 처리 등...
- 싱글 스레드이기 때문에 스레드가 에러로 인해 멈추지 않도록 잘 관리해야 함
- 내장된 웹 서버를 사용하기에 편함
  - 서버 규모가 커지면 별도의 웹 서버를 노드와 연결해야 함
- 자바스크립트를 사용하기에 프론트/백엔드 작업을 한 언어로 처리 가능

### 장단점

| 장점 | 단점 |
|-|-|
| 멀티 스레드 방식에 비해 컴퓨터 자원을 적게 사용 | 싱글 스레드라서 CPU 코어를 하나만 사용 |
| I/O 작업이 많은 서버로 적합 | CPU 작업이 많은 서버로는 부적합 |
| 멀티 스레드 방식보다 쉬움 | 하나뿐인 스레드가 멈추지 않도록 관리해야 함 |
| 웹 서버가 내장되어 있음 | 서버 규모가 커졌을 때 서버를 관리하기 어려움 |
| 자바스크립트를 사용 | 어중간한 성능 |
| JSON 형식과 호환하기 쉬움 |  |


## 6. 서버 외의 노드

- 웹 프레임워크: Angular, React, Vue, Meteor
- 모바일 개발 도구: React Native, Ionic Framework
- 데스크톱 개발 도구: Electron
